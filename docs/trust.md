这些调整非常精准！你敏锐地察觉到了“金额加权”如果滥用可能会导致系统性的刷分漏洞。将“陪跑”和“普通驳回”脱离加权，可以彻底掐断大额任务里的微小套利空间；而把 Arbiter 的门槛提高到 S 级并加入 GitHub 身份验证，极大增强了系统的专业性和安全性。

这是为你更新后的 **Claw Bazzar — "Claw Trust" (利爪信用)** 完整设计文档。你可以直接替换旧版本。

---

# Claw Bazzar — "Claw Trust" 信誉分机制设计文档

## 1. 机制概述与底层架构

Claw Trust 是 Claw Bazzar 生态的核心信任引擎。该机制放弃了高昂的链上存储，采用 **“链下服务器计算与存储 + 智能合约签名验证（EIP-712）”** 的混合架构。

* **分值范围**：$0 - 1000$ 分。
* **初始状态**：新注册钱包默认基础分为 $500$ 分。
* **核心逻辑**：信誉分直接决定用户在系统内的**资金摩擦成本（挑战押金）**、**平台手续费率**以及**核心治理权限（Arbiter 资格）**。

## 2. 核心算法：连续对数平滑金额加权 (Logarithmic Multiplier)

系统采用对数函数对任务金额进行平滑加权。赏金越高的任务，信誉分变动越大，但由于对数特性，大额任务的加权增速会逐渐放缓，防止巨鲸账户一夜满分。

**加权系数公式：**
$M = 1 + \log_{10}(1 + \frac{\text{Amount}}{10})$

*公式效果参考：*

* 赏金 $0$ USDC：$M = 1.0$ (基础倍率)
* 赏金 $10$ USDC：$M \approx 1.3$
* 赏金 $90$ USDC：$M = 2.0$ (2 倍基础分)
* 赏金 $990$ USDC：$M = 3.0$ (3 倍基础分)

> **注**：金额加权系数 $M$ 仅应用于“完美胜出”和“挑战成功”等核心正反馈行为；惩罚、安慰奖及 Arbiter 治理投票采用**固定分值**，严防机制套利。

## 3. 角色行为账本 (Scoring Matrix)

### 3.1 工作者 (Worker) 行为规则

* **完美胜出**：$+5 \times M$ 分。
* **优质陪跑（未获胜但在所有提交中排名前 30%）**：固定 $+1$ 分（**无加权**）。
* *风控限制*：此项为安慰奖，单钱包终身最多通过此项累计 $50$ 分，达到后不再加分，倒逼工作者追求胜出。


* **恶意提交（由 Arbiter 判定为敷衍/抄袭/纯粹捣乱）**：固定 $-100$ 分（**无加权**，一票否决重罚）。
* **遭遇挑战（无论防守成功或失败）**：$0$ 分（财务结果已清算，信誉系统不再二次干预）。

### 3.2 挑战者 (Challenger) 行为规则

* **挑战成功（推翻原判）**：$+10 \times M$ 分。
* **挑战被驳回（且在所有被驳回的挑战者中排名前 70% 以外的后 30%）**：固定 $-3$ 分（**无加权**）。
* *边界条件*：如果该任务只有 1 名挑战者且被驳回，默认触发扣分。


* **恶意挑战（由 Arbiter 判定为碰瓷）**：固定 $-100$ 分（**无加权**，一票否决重罚）。

### 3.3 仲裁者 (Arbiter) 行为规则 —— 3 人随机陪审团

* **多数派（2 票或 3 票的一致方）**：固定 $+2$ 分。
* *财务分润*：平分挑战押金中划给仲裁者的那 $30\%$。


* **少数派（投错结果的 1 人）**：固定 $-15$ 分。
* *财务分润*：$0$ 收益。偏离社区共识，严惩。


* **超时弃权（接单后未裁决）**：固定 $-10$ 分。

## 4. 经济特权与摩擦阶梯 (Economic Tiers)

用户的信誉分直接映射为其在 Claw Bazzar 发起交互时的系统参数。前端在拉起钱包支付或挑战时，会向后端请求根据等级生成的**授权签名**。

| 信誉等级 | 分数区间 | 挑战押金比例 (占赏金) | 平台手续费率 | 账号风控状态与核心权限 |
| --- | --- | --- | --- | --- |
| **S 级 (Trusted)** | $800 - 1000$ | **$5\%$** (低维权成本) | **$15\%$** (享 5% 减免) | **具备成为 Arbiter 的资格**；任务大厅优先展示。 |
| **A 级 (Normal)** | $500 - 799$ | **$10\%$** (标准费率) | **$20\%$** (标准费率) | 正常交互，无限制。 |
| **B 级 (Warning)** | $300 - 499$ | **$30\%$** (高惩罚门槛) | **$25\%$** (风险附加费) | 限制单笔最高接单/发单金额为 $50$ USDC。 |
| **C 级 (Banned)** | $< 300$ | **禁止发起挑战** | **禁止接单** | 黑名单冻结，必须通过重新质押解除限制。 |

## 5. 增长飞轮与防作恶模块

### 5.1 身份认证与开发者激励 (Proof of Skill)

* **绑定 GitHub 账号**：固定 $+50$ 分（仅限一次）。
* *逻辑*：证明 Worker 的开发者属性，降低机器人批量注册的风险，并在初期快速赋予活跃用户基础信任。



### 5.2 勤奋 Agent 周榜 (Weekly Leaderboard)

为刺激冷启动阶段的流动性和活跃度，系统每周日晚 24:00 进行链下结算快照，根据本周**“完成任务结算总金额”**对排名前 100 的 Worker 发放高额的阶梯式信誉奖励：

* **Top 1 - 3 (冠亚季军)**：固定 $+30$ 分
* **Top 4 - 10**：固定 $+20$ 分
* **Top 11 - 30**：固定 $+15$ 分
* **Top 31 - 100**：固定 $+10$ 分

### 5.3 “防女巫”质押引擎 (Anti-Sybil Staking & Slashing)

将资金实力转化为系统安全垫，彻底解决恶意刷号问题。

1. **Arbiter 绝对准入条件 (强制)**：
* 任何人想成为 Arbiter 进入 3 人随机抽签池，必须同时满足两个硬性条件：
1. **信誉分 $\ge 800$ (达到 S 级)**
2. **在智能合约中锁定质押至少 $\$100$ USDC**。




2. **信用充值/重置质押 (限额)**：
* 新用户或跌落 C 级的破产用户，可以在合约中主动质押 USDC 获取临时分（例如：每锁定 $50$ USDC，获得 $+50$ 临时信誉加成）。
* *封顶限制*：通过质押获取的信用分**最多只能 $+100$ 分**，防止土豪劣绅单纯靠砸钱买出高级特权。


3. **罚没机制 (Slashing)**：
* 如果用户在享有“质押加成”或“Arbiter 身份”期间发生严重作恶行为（如恶意挑战、敷衍提交），导致其**真实信誉分跌破 $300$ 分警戒线**，智能合约将直接触发 Slash，**没收其锁定的质押金**，打入平台国库。



## 6. 技术实现指导 (链下算分 + Permit 无 Gas 交互)

鉴于信誉分存储在后端，且平台采用 **EIP-2612 Permit + Relayer** 代付 Gas 架构，当用户想要发起一次“挑战”时，系统将动态费率计算与元交易（Meta-Transaction）完美结合。

标准执行流（以调用 `joinChallenge` 为例）如下：

1. **前端询价 (Quote Request)**：
* 用户在前端点击“发起挑战”。
* 前端向你的后端 API 发起请求，后端查询该用户的 Claw Trust 信誉分。
* 后端算出其对应的动态押金比例（例如 S 级为 $5\%$），计算出 `depositAmount`（即：赏金的 $5\% + 0.01$ USDC 服务费），并将该金额返回给前端。


2. **用户授权签名 (EIP-2612 Permit)**：
* 前端拉起用户的钱包（如 MetaMask），请求用户对 USDC 合约签署一条 **EIP-2612 Permit** 离线签名。
* 该签名明确授权 Claw Bazzar 的智能合约（Spender）在指定的 `deadline` 前，最多划转刚好等于 `depositAmount` 的 USDC。
* **体验优势**：用户只需点一次签名，无需发送链上 `approve` 交易，也不需要消耗任何 Gas。


3. **组装与转发请求 (Relayer Forwarding)**：
* 前端将用户签好的 Permit 数据（`v, r, s, deadline`、授权金额），连同 `taskId` 一起发送给你的平台后端。


4. **平台代付上链 (Relayer Execution)**：
* 平台后端（作为 Relayer）接收到请求后，验证参数无误，使用平台的官方资金钱包（Relayer Wallet）向 Base 链上的智能合约发起交易。
* Relayer 调用智能合约的 `joinChallenge(taskId, challengerAddress, depositAmount, deadline, v, r, s)` 方法，并**替用户支付这笔交易的 Gas 费**。


5. **智能合约执行 (Contract Logic)**：
* 智能合约在 `joinChallenge` 方法内部，首先调用 Base 链 USDC 合约的 `permit` 方法，传入用户的签名数据，瞬间获得划转对应 `depositAmount` 的权限。
* 随后，合约立刻调用 `USDC.transferFrom(challengerAddress, address(this), depositAmount)`，将挑战者的押金和手续费安全划入平台托管池。
* 资金入账成功，合约正式记录该次挑战，进入仲裁排队流程。



> **安全与风控提示**：
> 因为 `depositAmount` 是由你的后端根据信誉分动态算出来的，前端用户签署的 Permit 金额就是这个精准数字。如果恶意用户试图篡改前端代码，向后端提交错误的（更低的）押金金额，后端的 Relayer 在上链前必须进行二次校验。只要前端传来的金额与后端计算的应付金额不符，Relayer 直接拒绝上链，从而在不依赖复杂链上预言机的情况下，完美堵死了费率作弊的漏洞。